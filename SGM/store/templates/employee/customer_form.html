{% extends "employee/employee_layout.html" %}
{% load widget_tweaks %}

{% block title %}
    {% if isCreate %}
        สมัครสมาชิก
    {% else %}
        แก้ไขข้อมูล
    {% endif %}
{% endblock title %}

{% block nav %}
    {% if not user.is_authenticated %}
        {% include "visitor/navbar_visitor.html" %}
    {% elif user.customer %}
        {% include "customer/navbar_cus.html" %}
    {% elif user.is_staff %}
        {% include "manager/navbar_manager.html" %}
    {% else %}
        {% include "employee/navbar_emp.html" %}
    {% endif %}
{% endblock nav %}

{% block content %}
<div class="flex items-center justify-center p-8 bg-gray-100 min-h-screen">
    <div class="bg-white shadow-md rounded-lg w-full max-w-lg p-8">
        <h1 class="text-2xl text-center font-semibold mb-6">
            {% if isCreate %}
                สมัครสมาชิก
            {% else %}
                แก้ไขข้อมูลสมาชิก
            {% endif %}
        </h1>
        <form method="post">
            {% csrf_token %}
            <div class='space-y-4'>
                <div class="flex flex-col mb-4">
                    <label for="{{ form_auth.username.id_for_label }}" class="mb-1 font-medium">ชื่อผู้ใช้</label>
                    {{ form_auth.username|add_class:"px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400" }}
                    <div class="text-red-500 mt-1 text-sm">{{ form_auth.username.errors }}</div>
                </div>

                <div class="flex flex-col mb-4">
                    <label for="{{ form_auth.email.id_for_label }}" class="mb-1 font-medium">อีเมล</label>
                    {{ form_auth.email|add_class:"px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400" }}
                    <div class="text-red-500 mt-1 text-sm">{{ form_auth.email.errors }}</div>
                </div>

                <div class="flex gap-4 mb-4">
                    <div class="flex flex-col w-full">
                        <label for="{{ form_auth.first_name.id_for_label }}" class="mb-1 font-medium">ชื่อ</label>
                        {{ form_auth.first_name|add_class:"px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400" }}
                        <div class="text-red-500 mt-1 text-sm">{{ form_auth.first_name.errors }}</div>
                    </div>

                    <div class="flex flex-col w-full">
                        <label for="{{ form_auth.last_name.id_for_label }}" class="mb-1 font-medium">นามสกุล</label>
                        {{ form_auth.last_name|add_class:"px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400" }}
                        <div class="text-red-500 mt-1 text-sm">{{ form_auth.last_name.errors }}</div>
                    </div>
                </div>

                <div class="flex gap-4 mb-4">
                    <div class="flex flex-col w-full">
                        <label for="{{ form.gender.id_for_label }}" class="mb-1 font-medium">เพศ</label>
                        {{ form.gender|add_class:"px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400" }}
                        <div class="text-red-500 mt-1 text-sm">{{ form.gender.errors }}</div>
                    </div>

                    <div class="flex flex-col w-full">
                        <label for="{{ form.nickname.id_for_label }}" class="mb-1 font-medium">ชื่อเล่น</label>
                        {{ form.nickname|add_class:"px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400" }}
                        <div class="text-red-500 mt-1 text-sm">{{ form.nickname.errors }}</div>
                    </div>
                </div>

                {% if isCreate %}
                <div class="flex gap-4 mb-4">
                    <div class="flex flex-col w-full">
                        <label for="{{ form_auth.password1.id_for_label }}" class="mb-1 font-medium">รหัสผ่าน</label>
                        {{ form_auth.password1|add_class:"px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400" }}
                        <div class="text-red-500 mt-1 text-sm">{{ form_auth.password1.errors }}</div>
                    </div>

                    <div class="flex flex-col w-full">
                        <label for="{{ form_auth.password2.id_for_label }}" class="mb-1 font-medium">ยืนยันรหัสผ่าน</label>
                        {{ form_auth.password2|add_class:"px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400" }}
                        <div class="text-red-500 mt-1 text-sm">{{ form_auth.password2.errors }}</div>
                    </div>
                </div>
                {% endif %}

                {% if not user.customer and user.is_authenticated %}
                <div class="flex flex-col mb-4">
                    <label for="{{ form.notes.id_for_label }}" class="mb-1 font-medium">หมายเหตุ</label>
                    {{ form.notes|add_class:"p-2 border rounded h-20 focus:outline-none focus:ring-2 focus:ring-blue-400 resize-none" }}
                    <div class="text-red-500 mt-1 text-sm">{{ form.notes.errors }}</div>
                </div>
                {% endif %}
                
                <div class="flex justify-center gap-4 mt-6">
                    <button onclick='window.history.back()' type="button" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded transition duration-200">
                        ยกเลิก
                    </button>
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition duration-200">
                        ยืนยัน
                    </button>
                </div>
            </div>
        </form>

        {% if not isCreate %}
        <form method='POST' action='/change-password/' class='mt-8 flex flex-col items-center bg-gray-100 shadow-md rounded-lg p-4 w-full'>
            {% csrf_token %}
            <h1 class='text-2xl text-center font-semibold mb-6'>เปลี่ยนรหัสผ่าน</h1>
            <div class="flex flex-col mb-4 w-full">
                <label for="{{ password_form.old_password.id_for_label }}" class="mb-1 font-medium">รหัสผ่านเดิม</label>
                {{ password_form.old_password|add_class:"px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400 w-full" }}
                <div class="text-red-500 mt-1 text-sm">{{ password_form.old_password.errors }}</div>
            </div>
            <div class="flex flex-col mb-4 w-full">
                <label for="{{ password_form.new_password.id_for_label }}" class="mb-1 font-medium">รหัสผ่านใหม่</label>
                {{ password_form.new_password|add_class:"px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400 w-full" }}
                <div class="text-red-500 mt-1 text-sm">{{ password_form.new_password.errors }}</div>
            </div>
            <div class="flex flex-col mb-4 w-full">
                <label for="{{ password_form.confirm_password.id_for_label }}" class="mb-1 font-medium">ยืนยันรหัสผ่านใหม่</label>
                {{ password_form.confirm_password|add_class:"px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400 w-full" }}
                <div class="text-red-500 mt-1 text-sm">{{ password_form.confirm_password.errors }}</div>
            </div>
            <div class="flex justify-center gap-4 mt-6">
                <button onclick='window.history.back()' type="button" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded transition duration-200">
                    ยกเลิก
                </button>
                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition duration-200">
                    ยืนยัน
                </button>
            </div>
        </form>
        {% endif %}
    </div>
</div>
{% endblock content %}
